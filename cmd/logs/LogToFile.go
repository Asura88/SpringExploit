package logs

import (
	"github.com/SummerSec/SpringExploit/cmd/commons/utils"
	log "github.com/sirupsen/logrus"
	"io"
	"os"
	"path"
	"time"
)

func SaveLogs(logfile string) {
	if logfile != "" {

		f, err := os.OpenFile(logfile, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)
		if err == nil {
			mw := io.MultiWriter(os.Stdout, f)
			log.SetOutput(mw)
			log.SetFormatter(&log.TextFormatter{
				ForceColors:   true,
				FullTimestamp: true,
				//TimestampFormat: "2006-01-02 15:04:05",
			})
			log.SetReportCaller(true)
			log.Debugln("Saving logs to file " + logfile)
		} else {
			log.Info("Failed to log to file, using default stderr")
		}

	} else {
		logfile := "logs/log-" + time.Now().Format("202204221616") + ".txt"

		err := utils.Mkdir(path.Dir(logfile))
		if err != nil {
			log.Debugln("Failed to create logs directory")
			return
		}
		f, err := os.OpenFile(logfile, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)
		if err == nil {
			mw := io.MultiWriter(os.Stdout, f)

			log.SetOutput(mw)
			format := log.TextFormatter{
				ForceColors:   true,
				FullTimestamp: true,
				//TimestampFormat: "2006-01-02 15:04:05",
			}

			log.SetFormatter(&format)
			log.SetReportCaller(true)
			log.Debugln("Saving logs to file " + logfile)
		} else {
			log.Info("Failed to log to file, using default stderr")
		}

	}

}
