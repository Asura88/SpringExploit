package utils

import (
	"github.com/imroc/req/v3"
	log "github.com/sirupsen/logrus"
	"time"
)

const dnslogPre = "http://eyes.sh/api/"
const skysa = "/skysa/"
const token = "/?token=69a0b901"

type Dnslog struct {
	id  string
	pre string // dns or web
}

func (d *Dnslog) Pre() string {
	return d.pre
}

func (d *Dnslog) SetPre(pre string) {
	d.pre = pre
}

func (d *Dnslog) Id() string {
	return d.id
}

func (d *Dnslog) SetId(id string) {
	d.id = GetCode(16)
	//d.id = id
}

func (d *Dnslog) GetDnslog() bool {
	uuid := d.Id()
	//uuid := "dnslog"
	log.Debugln("uuid: ", uuid)
	d.SetId(uuid)
	t := d.Pre()
	log.Debugln("type: ", t)
	url := dnslogPre + t + skysa + uuid + token
	time.Sleep(time.Second * 3)
	log.Debugf("url: %s", url)
	resp, _ := req.R().Get(url)
	log.Debugln(resp.String())
	if resp.String() == "True" {
		return true
	}
	return false
}
